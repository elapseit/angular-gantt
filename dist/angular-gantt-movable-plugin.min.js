/*
Project: angular-gantt v1.3.3 - Gantt chart component for AngularJS
Authors: Marco Schweighauser, RÃ©mi Alvergnat
License: MIT
Homepage: https://www.angular-gantt.com
Github: https://github.com/angular-gantt/angular-gantt.git
*/

!function(){"use strict";angular.module("gantt.movable",["gantt"]).directive("ganttMovable",["ganttMouseButton","ganttMouseOffset","ganttSmartEvent","ganttMovableOptions","ganttUtils","ganttDom","$window","$document","$timeout",function(t,e,a,o,n,s,i,r,l){return{restrict:"E",require:"^gantt",scope:{enabled:"=?",allowMoving:"=?",allowResizing:"=?",allowRowSwitching:"=?"},link:function(g,d,k,u){var v=u.gantt.api;if(g.options&&"object"==typeof g.options.movable)for(var m in g.options.movable)g[m]=g.options.movable[m];o.initialize(g),v.registerEvent("tasks","move"),v.registerEvent("tasks","moveBegin"),v.registerEvent("tasks","moveEnd"),v.registerEvent("tasks","resize"),v.registerEvent("tasks","resizeBegin"),v.registerEvent("tasks","resizeEnd"),v.registerEvent("tasks","change");var c,w,f="ontouchstart"in i||i.DocumentTouch&&r[0]instanceof i.DocumentTouch,M="touchstart mousedown";v.directives.on.new(g,function(o,d,k){if("ganttTask"===o){var v,m=angular.element(i),b=d.row.rowsManager.gantt.body.$element,p=d.row.rowsManager.gantt.scroll.$element,h=!1,y=!1,E=d.task.getForegroundElement(),R=d.task.getContentElement(),z=function(a){a.preventDefault(),f&&(a=e.getTouch(a));var o=d.task.model.movable,s=d.task.row.model.movable;("boolean"==typeof o||angular.isFunction(o))&&(o={enabled:o}),("boolean"==typeof s||angular.isFunction(s))&&(s={enabled:s});var i=n.firstProperty([o,s],"enabled",g.enabled);if(angular.isFunction(i)?i(a,d.task):i){var r=e.getOffsetForElement(E[0],a).x,l=x(r);if(""!==l&&1===t.getButton(a)){var k=e.getOffsetForElement(b[0],a).x;W(l,k)}d.$digest()}};E.on(M,z),R.on(M,z);var F=function(t){var a=d.task.model.movable,o=d.task.row.model.movable;("boolean"==typeof a||angular.isFunction(a))&&(a={enabled:a}),("boolean"==typeof o||angular.isFunction(o))&&(o={enabled:o});var s=n.firstProperty([a,o],"enabled",g.enabled);if((angular.isFunction(s)?s(t,d.task):s)&&!d.task.isMoving){var i=e.getOffsetForElement(E[0],t).x,r=x(i);""!==r&&"M"!==r?(E.css("cursor",P(r)),R.css("cursor",P(r))):(E.css("cursor",""),R.css("cursor",""))}};E.on("mousemove",F),R.on("mousemove",F);var $=function(t){d.task.isMoving&&!d.destroyed&&(S(),O(t),T(t))},O=function(t){var a=h,o=e.getOffsetForElement(b[0],t).x;d.task.mouseOffsetX=o;var i=d.task.row.rowsManager.gantt.options.value("taskOutOfRange"),l=d.task.model.movable,k=d.task.row.model.movable;if(("boolean"==typeof l||angular.isFunction(l))&&(l={enabled:l}),("boolean"==typeof k||angular.isFunction(k))&&(k={enabled:k}),"M"===d.task.moveMode){var v=n.firstProperty([l,k],"allowRowSwitching",g.allowRowSwitching);if(v){var m=p[0].getBoundingClientRect(),w=m.left+m.width/2,f=angular.element(r[0].querySelectorAll(".gantt-body"));f.css("pointer-events","auto");var M=s.findElementFromPoint(w,t.clientY,function(t){return angular.element(t).hasClass("gantt-row")});f.css("pointer-events","");for(var E,R=u.gantt.rowsManager.rows,z=0,F=R.length;z<F;z++)if(R[z].$element&&M===R[z].$element[0]){E=R[z];break}var $=d.task.row;void 0!==E&&$!==E&&(angular.isFunction(v)&&!v(d.task,E)||(E.moveTaskToRow(d.task,!0),h=!0))}n.firstProperty([l,k],"allowMoving",g.allowMoving)&&(o-=c,"truncate"!==i&&(o<0?o=0:o+d.task.width>=d.gantt.width&&(o=d.gantt.width-d.task.width)),d.task.moveTo(o,!0),d.$digest(),h&&d.row.rowsManager.gantt.api.tasks.raise.move(d.task),h=!0)}else"E"===d.task.moveMode?(o<=d.task.left&&(o=d.task.left,d.task.moveMode="W",C(P(d.task.moveMode))),"truncate"!==i&&o>=d.gantt.width&&(o=d.gantt.width),d.task.setTo(o,!0),d.$digest(),h&&d.row.rowsManager.gantt.api.tasks.raise.resize(d.task),h=!0):(o>d.task.left+d.task.width&&(o=d.task.left+d.task.width,d.task.moveMode="E",C(P(d.task.moveMode))),"truncate"!==i&&o<0&&(o=0),d.task.setFrom(o,!0),d.$digest(),h&&d.row.rowsManager.gantt.api.tasks.raise.resize(d.task),h=!0);a||!h||y||("M"===d.task.moveMode?d.row.rowsManager.gantt.api.tasks.raise.moveBegin(d.task):d.row.rowsManager.gantt.api.tasks.raise.resizeBegin(d.task))},T=function(t){var a=e.getOffsetForElement(b[0],t),o=p[0].scrollLeft,n=p[0].offsetWidth,s=p[0].scrollWidth,i=o+n,r=!1;a.x<w?o>0&&a.x<=o+5&&(a.x-=15,r=!0,d.row.rowsManager.gantt.api.scroll.left(15)):i<s&&a.x>=i-5&&(a.x+=15,r=!0,d.row.rowsManager.gantt.api.scroll.right(15)),r&&(v=l(function(){$(t)},100,!0))},S=function(){void 0!==v&&(l.cancel(v),v=void 0)},x=function(t){var e=0,a=d.task.model.movable,o=d.task.row.model.movable;"boolean"==typeof a&&(a={enabled:a}),"boolean"==typeof o&&(o={enabled:o});var s=n.firstProperty([a,o],"allowResizing",g.allowResizing),i=n.firstProperty([a,o],"allowRowSwitching",g.allowRowSwitching),r=n.firstProperty([a,o],"allowMoving",g.allowMoving);return s&&(e=E[0].offsetWidth<15?3:5),s&&t>E[0].offsetWidth-e?"E":s&&t<e?"W":(r||i)&&t>=e&&t<=E[0].offsetWidth-e?"M":""},P=function(t){switch(t){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},C=function(t){k.css("cursor",t),angular.element(r[0].body).css({"-moz-user-select":""===t?"":"-moz-none","-webkit-user-select":""===t?"":"none","-ms-user-select":""===t?"":"none","user-select":""===t?"":"none",cursor:t})},W=function(t,o){void 0===d.task.originalModel&&(d.task.originalRow=d.task.row,d.task.originalModel=d.task.model,d.task.model=angular.copy(d.task.originalModel)),y||(w=o,c=o-d.task.modelLeft),h=!1,d.task.moveMode=t,d.task.isMoving=!0,d.task.active=!0;var n=d.task.$element;"M"===d.task.moveMode?n.addClass("gantt-task-resizing"):n.addClass("gantt-task-moving");var s=a(d,m,"touchmove mousemove",function(t){t.stopImmediatePropagation(),f&&(t=e.getTouch(t)),$(t)});s.bind(),a(d,m,"touchend mouseup",function(t){f&&(t=e.getTouch(t)),s.unbind(),B(t),d.$digest()}).bindOnce(),C(P(t))},B=function(){if(void 0!==d.task.originalModel){if(d.task.originalModel.from=d.task.model.from,d.task.originalModel.to=d.task.model.to,d.task.originalModel.lct=d.task.model.lct,d.task.originalModel.est=d.task.model.est,d.task.model=d.task.originalModel,d.task.row.model.id!==d.task.originalRow.model.id){var t=d.task.row;t.removeTask(d.task.model.id,!1,!0),d.task.row=d.task.originalRow,t.moveTaskToRow(d.task,!1)}delete d.task.originalModel,delete d.task.originalRow,d.$apply()}y=!1,d.task.isMoving=!1,d.task.active=!1;var e=d.task.$element;e.removeClass("gantt-task-moving"),e.removeClass("gantt-task-resizing"),S(),C(""),!0===h&&("M"===d.task.moveMode?d.row.rowsManager.gantt.api.tasks.raise.moveEnd(d.task):d.row.rowsManager.gantt.api.tasks.raise.resizeEnd(d.task),h=!1,d.task.row.sortTasks(),d.row.rowsManager.gantt.api.tasks.raise.change(d.task)),d.task.moveMode=void 0};d.$on("$destroy",function(){d.destroyed=!0,S()}),d.task.isResizing?(y=!0,W("E",d.task.mouseOffsetX),delete d.task.isResizing):d.task.isMoving&&(y=!0,W("M",d.task.mouseOffsetX))}})}}}])}(),function(){"use strict";angular.module("gantt.movable").factory("ganttMovableOptions",[function(){return{initialize:function(t){return t.enabled=void 0===t.enabled||t.enabled,t.allowMoving=void 0===t.allowMoving||!!t.allowMoving,t.allowResizing=void 0===t.allowResizing||!!t.allowResizing,angular.isFunction(t.allowRowSwitching)||(t.allowRowSwitching=void 0===t.allowRowSwitching||!!t.allowRowSwitching),t}}}])}(),angular.module("gantt.movable.templates",[]).run(["$templateCache",function(t){}]);
//# sourceMappingURL=angular-gantt-movable-plugin.min.js.map