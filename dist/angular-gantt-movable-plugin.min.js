/*
Project: angular-gantt v1.3.0 - Gantt chart component for AngularJS
Authors: Marco Schweighauser, RÃ©mi Alvergnat
License: MIT
Homepage: https://www.angular-gantt.com
Github: https://github.com/angular-gantt/angular-gantt.git
*/

!function(){"use strict";angular.module("gantt.movable",["gantt"]).directive("ganttMovable",["ganttMouseButton","ganttMouseOffset","ganttSmartEvent","ganttMovableOptions","ganttUtils","ganttDom","$window","$document","$timeout",function(t,e,o,a,n,s,i,r,l){return{restrict:"E",require:"^gantt",scope:{enabled:"=?",allowMoving:"=?",allowResizing:"=?",allowRowSwitching:"=?"},link:function(g,d,k,u){var v=u.gantt.api;if(g.options&&"object"==typeof g.options.movable)for(var m in g.options.movable)g[m]=g.options[m];a.initialize(g),v.registerEvent("tasks","move"),v.registerEvent("tasks","moveBegin"),v.registerEvent("tasks","moveEnd"),v.registerEvent("tasks","resize"),v.registerEvent("tasks","resizeBegin"),v.registerEvent("tasks","resizeEnd"),v.registerEvent("tasks","change");var c,w,f="ontouchstart"in i||i.DocumentTouch&&r[0]instanceof i.DocumentTouch,M="touchstart mousedown";v.directives.on.new(g,function(a,d,k){if("ganttTask"===a){var v,m=angular.element(i),b=d.row.rowsManager.gantt.body.$element,p=d.row.rowsManager.gantt.scroll.$element,h=!1,E=!1,y=d.task.getForegroundElement(),R=d.task.getContentElement(),z=function(o){o.preventDefault(),f&&(o=e.getTouch(o));var a=d.task.model.movable,s=d.task.row.model.movable;("boolean"==typeof a||angular.isFunction(a))&&(a={enabled:a}),("boolean"==typeof s||angular.isFunction(s))&&(s={enabled:s});var i=n.firstProperty([a,s],"enabled",g.enabled);if(angular.isFunction(i)?i(o,d.task):i){var r=e.getOffsetForElement(y[0],o).x,l=x(r);if(""!==l&&1===t.getButton(o)){var k=e.getOffsetForElement(b[0],o).x;C(l,k)}d.$digest()}};y.on(M,z),R.on(M,z);var F=function(t){var o=d.task.model.movable,a=d.task.row.model.movable;("boolean"==typeof o||angular.isFunction(o))&&(o={enabled:o}),("boolean"==typeof a||angular.isFunction(a))&&(a={enabled:a});var s=n.firstProperty([o,a],"enabled",g.enabled);if((angular.isFunction(s)?s(t,d.task):s)&&!d.task.isMoving){var i=e.getOffsetForElement(y[0],t).x,r=x(i);""!==r&&"M"!==r?(y.css("cursor",B(r)),R.css("cursor",B(r))):(y.css("cursor",""),R.css("cursor",""))}};y.on("mousemove",F),R.on("mousemove",F);var $=function(t){d.task.isMoving&&!d.destroyed&&(S(),O(t),T(t))},O=function(t){var o=h,a=e.getOffsetForElement(b[0],t).x;d.task.mouseOffsetX=a;var i=d.task.row.rowsManager.gantt.options.value("taskOutOfRange"),l=d.task.model.movable,k=d.task.row.model.movable;if(("boolean"==typeof l||angular.isFunction(l))&&(l={enabled:l}),("boolean"==typeof k||angular.isFunction(k))&&(k={enabled:k}),"M"===d.task.moveMode){if(n.firstProperty([l,k],"allowRowSwitching",g.allowRowSwitching)){var v=p[0].getBoundingClientRect(),m=v.left+v.width/2,w=angular.element(r[0].querySelectorAll(".gantt-body"));w.css("pointer-events","auto");var f=s.findElementFromPoint(m,t.clientY,function(t){return angular.element(t).hasClass("gantt-row")});w.css("pointer-events","");for(var M,y=u.gantt.rowsManager.rows,R=0,z=y.length;R<z;R++)if(y[R].$element&&f===y[R].$element[0]){M=y[R];break}var F=d.task.row;void 0!==M&&F!==M&&(M.moveTaskToRow(d.task,!0),h=!0)}n.firstProperty([l,k],"allowMoving",g.allowMoving)&&(a-=c,"truncate"!==i&&(a<0?a=0:a+d.task.width>=d.gantt.width&&(a=d.gantt.width-d.task.width)),d.task.moveTo(a,!0),d.$digest(),h&&d.row.rowsManager.gantt.api.tasks.raise.move(d.task),h=!0)}else"E"===d.task.moveMode?(a<=d.task.left&&(a=d.task.left,d.task.moveMode="W",P(B(d.task.moveMode))),"truncate"!==i&&a>=d.gantt.width&&(a=d.gantt.width),d.task.setTo(a,!0),d.$digest(),h&&d.row.rowsManager.gantt.api.tasks.raise.resize(d.task),h=!0):(a>d.task.left+d.task.width&&(a=d.task.left+d.task.width,d.task.moveMode="E",P(B(d.task.moveMode))),"truncate"!==i&&a<0&&(a=0),d.task.setFrom(a,!0),d.$digest(),h&&d.row.rowsManager.gantt.api.tasks.raise.resize(d.task),h=!0);o||!h||E||("M"===d.task.moveMode?d.row.rowsManager.gantt.api.tasks.raise.moveBegin(d.task):d.row.rowsManager.gantt.api.tasks.raise.resizeBegin(d.task))},T=function(t){var o=e.getOffsetForElement(b[0],t),a=p[0].scrollLeft,n=p[0].offsetWidth,s=p[0].scrollWidth,i=a+n,r=!1;o.x<w?a>0&&o.x<=a+5&&(o.x-=15,r=!0,d.row.rowsManager.gantt.api.scroll.left(15)):i<s&&o.x>=i-5&&(o.x+=15,r=!0,d.row.rowsManager.gantt.api.scroll.right(15)),r&&(v=l(function(){$(t)},100,!0))},S=function(){void 0!==v&&(l.cancel(v),v=void 0)},x=function(t){var e=0,o=d.task.model.movable,a=d.task.row.model.movable;"boolean"==typeof o&&(o={enabled:o}),"boolean"==typeof a&&(a={enabled:a});var s=n.firstProperty([o,a],"allowResizing",g.allowResizing),i=n.firstProperty([o,a],"allowRowSwitching",g.allowRowSwitching),r=n.firstProperty([o,a],"allowMoving",g.allowMoving);return s&&(e=y[0].offsetWidth<15?3:5),s&&t>y[0].offsetWidth-e?"E":s&&t<e?"W":(r||i)&&t>=e&&t<=y[0].offsetWidth-e?"M":""},B=function(t){switch(t){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},P=function(t){k.css("cursor",t),angular.element(r[0].body).css({"-moz-user-select":""===t?"":"-moz-none","-webkit-user-select":""===t?"":"none","-ms-user-select":""===t?"":"none","user-select":""===t?"":"none",cursor:t})},C=function(t,a){void 0===d.task.originalModel&&(d.task.originalRow=d.task.row,d.task.originalModel=d.task.model,d.task.model=angular.copy(d.task.originalModel)),E||(w=a,c=a-d.task.modelLeft),h=!1,d.task.moveMode=t,d.task.isMoving=!0,d.task.active=!0;var n=d.task.getBackgroundElement();"M"===d.task.moveMode?n.addClass("gantt-task-resizing"):n.addClass("gantt-task-moving");var s=o(d,m,"touchmove mousemove",function(t){t.stopImmediatePropagation(),f&&(t=e.getTouch(t)),$(t)});s.bind(),o(d,m,"touchend mouseup",function(t){f&&(t=e.getTouch(t)),s.unbind(),W(t),d.$digest()}).bindOnce(),P(B(t))},W=function(){if(void 0!==d.task.originalModel){if(d.task.originalModel.from=d.task.model.from,d.task.originalModel.to=d.task.model.to,d.task.originalModel.lct=d.task.model.lct,d.task.originalModel.est=d.task.model.est,d.task.model=d.task.originalModel,d.task.row.model.id!==d.task.originalRow.model.id){var t=d.task.row;t.removeTask(d.task.model.id,!1,!0),d.task.row=d.task.originalRow,t.moveTaskToRow(d.task,!1)}delete d.task.originalModel,delete d.task.originalRow,d.$apply()}E=!1,d.task.isMoving=!1,d.task.active=!1;var e=d.task.getBackgroundElement();e.removeClass("gantt-task-moving"),e.removeClass("gantt-task-resizing"),S(),P(""),!0===h&&("M"===d.task.moveMode?d.row.rowsManager.gantt.api.tasks.raise.moveEnd(d.task):d.row.rowsManager.gantt.api.tasks.raise.resizeEnd(d.task),h=!1,d.task.row.sortTasks(),d.row.rowsManager.gantt.api.tasks.raise.change(d.task)),d.task.moveMode=void 0};d.$on("$destroy",function(){d.destroyed=!0,S()}),d.task.isResizing?(E=!0,C("E",d.task.mouseOffsetX),delete d.task.isResizing):d.task.isMoving&&(E=!0,C("M",d.task.mouseOffsetX))}})}}}])}(),function(){"use strict";angular.module("gantt.movable").factory("ganttMovableOptions",[function(){return{initialize:function(t){return t.enabled=void 0===t.enabled||t.enabled,t.allowMoving=void 0===t.allowMoving||!!t.allowMoving,t.allowResizing=void 0===t.allowResizing||!!t.allowResizing,t.allowRowSwitching=void 0===t.allowRowSwitching||!!t.allowRowSwitching,t}}}])}(),angular.module("gantt.movable.templates",[]).run(["$templateCache",function(t){}]);
